(self.webpackChunk=self.webpackChunk||[]).push([[494],{24563:function(v,i,e){"use strict";e.r(i),e.d(i,{default:function(){return M}});var t=e(5574),r=e.n(t),l=e(62435),c=e(2453),d=e(25138),m={"term-contain":"term-contain___Wn1jx"},o=e(84802),h=e(12320),f=e(12617),w=e(86074),y=function(k){var N=(0,d.useParams)(),x=(0,d.useSearchParams)(),I=r()(x,1),u=I[0];console.log(u.get("id"));var A="terminalKey",p=(0,l.useRef)(null),C=(0,l.useState)("processing"),P=r()(C,2),b=P[0],S=P[1],s;console.log(Math.floor(window.innerWidth/9),Math.floor(window.innerHeight/20));var a=(0,l.useRef)(new h.Terminal({disableStdin:!1,cursorBlink:!0,convertEol:!0,cols:Math.floor(window.innerWidth/9)-1,rows:Math.floor(window.innerHeight/20)-1,windowsMode:!0,theme:{foreground:"#ECECEC",background:"#000000",black:"\x1B[30m"}})),E=function(){console.log("init termainl",(0,o.LP)()),s=new WebSocket("ws://".concat(window.location.host,"/ws/").concat(u.get("id"),"?row=").concat(Math.floor(window.innerHeight/20)-1,"&col=").concat(Math.floor(window.innerWidth/9-1),"&token=").concat((0,o.LP)())),s.addEventListener("beforeSend",function(n){var g;console.log("beforeSend"),(g=n.target)===null||g===void 0||g.setRequestHeader(o._n,(0,o.LP)())}),s.onopen=function(){console.log("connection ws done."),S("success"),a.current.reset(),a.current.open(p.current);var n=new f.FitAddon;a.current.loadAddon(n),n.fit(),a.current.writeln(`welcome web terminal \r
init done  `+new Date)},s.onmessage=function(n){a.current.write(n.data)};function F(){s.send(new Uint8Array([9]))}setInterval(F,1e4);var V=a.current.cols,W=a.current.rows;console.log(V,W),s.onclose=function(n){console.log("ws closed, ",n),S("error"),c.ZP.error("please check token or contact the administrator. ",10)},a.current.onData(function(n){return s.send(n)})};return(0,l.useEffect)(function(){return document.title="".concat(u.get("ip")," - ").concat(u.get("name")),E(),function(){console.log("clear...."),s.close(1e3,"client close request."),a.current.dispose()}},[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)("div",{className:m.termContain,ref:p},A)})},M=y},12617:function(v){(function(i,e){v.exports=e()})(self,function(){return(()=>{"use strict";var i={};return(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.FitAddon=void 0,e.FitAddon=class{constructor(){}activate(t){this._terminal=t}dispose(){}fit(){const t=this.proposeDimensions();if(!t||!this._terminal||isNaN(t.cols)||isNaN(t.rows))return;const r=this._terminal._core;this._terminal.rows===t.rows&&this._terminal.cols===t.cols||(r._renderService.clear(),this._terminal.resize(t.cols,t.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const t=this._terminal._core,r=t._renderService.dimensions;if(r.css.cell.width===0||r.css.cell.height===0)return;const l=this._terminal.options.scrollback===0?0:t.viewport.scrollBarWidth,c=window.getComputedStyle(this._terminal.element.parentElement),d=parseInt(c.getPropertyValue("height")),m=Math.max(0,parseInt(c.getPropertyValue("width"))),o=window.getComputedStyle(this._terminal.element),h=d-(parseInt(o.getPropertyValue("padding-top"))+parseInt(o.getPropertyValue("padding-bottom"))),f=m-(parseInt(o.getPropertyValue("padding-right"))+parseInt(o.getPropertyValue("padding-left")))-l;return{cols:Math.max(2,Math.floor(f/r.css.cell.width)),rows:Math.max(1,Math.floor(h/r.css.cell.height))}}}})(),i})()})}}]);
